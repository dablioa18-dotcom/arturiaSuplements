import{n as e,o as t,s as n}from"./index-Dl_z27bg.js";var r=n(t(),1);const i=e=>String(e||``).replace(/\D/g,``),a=e=>{let t=i(e).slice(0,11),n=t.slice(0,3),r=t.slice(3,6),a=t.slice(6,9),o=t.slice(9,11),s=``;return n&&(s+=n),r&&(s+=`.`+r),a&&(s+=`.`+a),o&&(s+=`-`+o),s},o=e=>{let t=i(e);if(t.length!==11||/^(\d)\1{10}$/.test(t))return!1;let n=(e,t)=>{let n=0;for(let r=0;r<e.length;r++)n+=Number(e[r])*(t-r);let r=n%11;return r<2?0:11-r},r=n(t.slice(0,9),10),a=n(t.slice(0,9)+String(r),11);return t.endsWith(String(r)+String(a))},s=e=>{let t=String(e||``);return t.includes(`@`)?/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(t):!1};var c=n(e(),1);function l(){let[e,t]=(0,r.useState)([]),[n,i]=(0,r.useState)(1),[l,u]=(0,r.useState)(null),[d,f]=(0,r.useState)(``),[p,m]=(0,r.useState)(!1),[h,g]=(0,r.useState)(``),[_,v]=(0,r.useState)(``),[y,b]=(0,r.useState)(``),[x,S]=(0,r.useState)(!1),[C,ee]=(0,r.useState)(!1),[w,T]=(0,r.useState)(``),[E,D]=(0,r.useState)(``),[O,k]=(0,r.useState)(``),[A,j]=(0,r.useState)(0),[M,N]=(0,r.useState)(0),[P,te]=(0,r.useState)(``),[F,ne]=(0,r.useState)(``);(0,r.useEffect)(()=>{try{let e=localStorage.getItem(`nutriflex_cart_items`),n=e?JSON.parse(e):[];t(Array.isArray(n)?n:[])}catch{t([])}},[]);let I=(0,r.useMemo)(()=>{let t={};for(let n of e){let e=n.id??n.name??n.title;t[e]||(t[e]={...n,qty:0}),t[e].qty+=1}return Object.values(t)},[e]),L=(0,r.useMemo)(()=>I.reduce((e,t)=>e+(t.price??0)*t.qty,0),[I]),R=(0,r.useMemo)(()=>I.reduce((e,t)=>e+(t.realPrice??0)*t.qty,0),[I]);(0,r.useEffect)(()=>{if(!A)return;let e=setInterval(()=>{let t=Math.max(0,Math.floor((A-Date.now())/1e3));N(t),t<=0&&(clearInterval(e),K(`Tempo esgotado (15min)`))},1e3);return()=>clearInterval(e)},[A]);let z=(0,r.useMemo)(()=>L>=45.99?0:45.99,[L]),B=(0,r.useMemo)(()=>L+z,[L,z]),V=(0,r.useMemo)(()=>Math.floor(L*5),[L]),H=[{id:`cc`,label:`Cart√£o de cr√©dito`},{id:`pix`,label:`Pix`}],[U,W]=(0,r.useState)(!1),[G,K]=(0,r.useState)(``),[q,J]=(0,r.useState)(null),[Y,X]=(0,r.useState)(``),[re,Z]=(0,r.useState)(!1),Q=e=>s(e),$=e=>o(e),ie=async()=>{if(!l)return;T(``);let e=!!String(_||``).trim(),t=Q(h),n=$(y);if(!e||!t||!n){T(`Preencha e-mail, nome e CPF v√°lidos`);return}let r=()=>{let e=`ABCDEFGHIJKLMNOPQRSTUVWXYZ`;return`${e[Math.floor(Math.random()*26)]}${e[Math.floor(Math.random()*26)]}${String(Math.floor(1e8+Math.random()*9e8))}`};if(l===`pix`)try{W(!0),K(``),J(null);let e=l===`pix`?.9:1,t=I.map(t=>({title:t.name??t.title??`Produto`,unitPrice:Math.round(Number(t.price??0)*100*e),quantity:Number(t.qty??1),tangible:!0})),n=t.reduce((e,t)=>e+t.unitPrice*t.quantity,0),i=`${typeof window<`u`&&window.location&&window.location.protocol?window.location.protocol:`http:`}//${typeof window<`u`&&window.location&&window.location.hostname?window.location.hostname:`localhost`}:3001`,a=await fetch(`${i}/api/pix/create`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({amount:n>0?n:Math.round(B*100),paymentMethod:`pix`,description:`Pedido Nutriflex`,items:t,customer:{name:_,email:h,document:{number:String(y||``).replace(/\D/g,``),type:`cpf`}}})}),o=await a.json();if(!a.ok)K(typeof o==`object`?JSON.stringify(o):String(o));else{J(o);let e=o&&(o.qr_code_text||o.qrCodeText)||o&&o.pix&&o.pix.qrcode||``;e&&(D(e),k(`https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(e)}`),j(Date.now()+900*1e3),N(900));let t=n>0?n:Math.round(B*100),a=Date.now(),s=!1;for(;Date.now()-a<9e5;){let e=await fetch(`${i}/api/pix/status/${o.id}`),n=await e.json();if(!e.ok){K(typeof n==`object`?JSON.stringify(n):String(n));break}let r=String(n.status||``),a=Number(n.paidAmount||0);if([`paid`,`approved`,`concluded`].includes(r)&&a>=t){s=!0;break}if([`refused`,`canceled`,`cancelled`,`expired`].includes(r)){K(`Pagamento recusado ou cancelado`);break}await new Promise(e=>setTimeout(e,5e3))}if(s){let e=r();f(e),S(!0);try{localStorage.setItem(`nutriflex_last_tracking_code`,e),localStorage.setItem(`nutriflex_tracking_created_at`,String(Date.now())),h&&localStorage.setItem(`nutriflex_customer_email`,h),_&&localStorage.setItem(`nutriflex_customer_name`,_),y&&localStorage.setItem(`nutriflex_customer_cpf`,String(y||``).replace(/\D/g,``))}catch{}try{let t=`${typeof window<`u`&&window.location&&window.location.protocol?window.location.protocol:`http:`}//${typeof window<`u`&&window.location&&window.location.hostname?window.location.hostname:`localhost`}:3001`;await fetch(`${t}/api/pix/delivery/${o.id}`,{method:`PUT`,headers:{"Content-Type":`application/json`},body:JSON.stringify({status:`in_transit`,trackingCode:e})})}catch{}try{let t={items:I.map(e=>({title:e.name??e.title??`Produto`,quantity:e.qty,unitPrice:e.price})),total:B},n=`${typeof window<`u`&&window.location&&window.location.protocol?window.location.protocol:`http:`}//${typeof window<`u`&&window.location&&window.location.hostname?window.location.hostname:`localhost`}:3001`,r=await fetch(`${n}/api/notify/confirmation`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({email:h,trackingCode:e,order:t})}),i=await r.json();r.ok?Z(!0):X(typeof i==`object`?JSON.stringify(i):String(i))}catch(e){X(String(e&&e.message?e.message:e))}setTimeout(()=>ee(!0),100)}else s||K(`Tempo esgotado para confirma√ß√£o`)}}catch(e){K(String(e&&e.message?e.message:e))}finally{W(!1)}},ae=async()=>{if(d)try{await navigator.clipboard.writeText(d),m(!0),setTimeout(()=>m(!1),3e3)}catch{}},oe=async()=>{if(E)try{await navigator.clipboard.writeText(E)}catch{}};return(0,r.useEffect)(()=>{try{let e=localStorage.getItem(`nutriflex_last_tracking_code`);e&&f(e)}catch{}},[]),(0,c.jsxs)(`div`,{className:`mx-auto max-w-5xl px-3 sm:px-4 py-4 sm:py-8`,children:[(0,c.jsx)(`h1`,{className:`text-2xl font-semibold mb-6`,children:`Pagamento`}),d&&x&&(0,c.jsx)(`div`,{className:`mb-4 rounded-md border-2 border-yellow-400 bg-yellow-50 px-4 py-3 transition-opacity duration-300 ${C?`opacity-100`:`opacity-0`}`,"aria-live":`polite`,"aria-atomic":`true`,children:(0,c.jsxs)(`div`,{className:`flex items-start gap-3`,children:[(0,c.jsx)(`div`,{className:`text-yellow-600 text-2xl`,"aria-hidden":`true`,children:`üì¶`}),(0,c.jsxs)(`div`,{className:`flex-1`,children:[(0,c.jsx)(`div`,{children:`pagamento confirmado`}),(0,c.jsx)(`div`,{className:`text-neutral-900 font-semibold`,children:` Seu C√≥digo de rastreio`}),(0,c.jsx)(`div`,{className:`mt-1`,children:(0,c.jsx)(`span`,{className:`inline-block font-mono text-lg tracking-widest bg-white text-neutral-900 px-3 py-1 rounded border border-yellow-300 select-all`,children:d})}),(0,c.jsxs)(`div`,{className:`mt-2 flex items-center gap-2`,children:[(0,c.jsxs)(`button`,{className:`inline-flex items-center gap-2 rounded-md bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-green-600`,onClick:ae,children:[(0,c.jsx)(`span`,{"aria-hidden":`true`,children:`üìã`}),`Copiar c√≥digo`]}),p&&(0,c.jsx)(`span`,{className:`text-green-700 text-sm`,children:`Copiado!`})]}),(0,c.jsx)(`div`,{className:`mt-1 text-sm text-neutral-700`,children:`Mantenha este c√≥digo para acompanhar seu pedido.`})]})]})}),(0,c.jsxs)(`div`,{className:`grid grid-cols-1 lg:grid-cols-3 gap-4`,children:[(0,c.jsxs)(`div`,{className:`lg:col-span-2 space-y-4`,children:[(0,c.jsxs)(`section`,{className:`rounded-md border border-neutral-400 `,children:[(0,c.jsx)(`div`,{className:` bg-neutral-100 px-4 py-2 text-neutral-700 font-semibold`,children:`1. Identifica√ß√£o`}),(0,c.jsxs)(`div`,{className:`p-4`,children:[(0,c.jsxs)(`div`,{className:`text-green-700 font-medium mb-2`,children:[`Dados pessoais`,(0,c.jsx)(`span`,{className:`text-neutral-500 text-xs`,children:`* Campos obrigat√≥rios`})]}),(0,c.jsxs)(`div`,{className:`space-y-3`,children:[(0,c.jsx)(`input`,{className:`w-40 rounded border p-2 ${P?`border-[#FF0000] text-[#FF0000]`:`border-neutral-100`}`,placeholder:`E-mail *`,required:!0,type:`email`,value:h,onChange:e=>{let t=e.target.value;g(t),te(s(t)?``:`E-mail inv√°lido. Use o formato nome@gmail.com`)}}),P&&(0,c.jsx)(`div`,{className:`text-xs`,style:{color:`#FF0000`},children:P}),(0,c.jsxs)(`label`,{className:`flex items-center gap-2 text-sm`,children:[(0,c.jsx)(`input`,{type:`checkbox`,className:`h-4 w-4`}),` Quero receber promo√ß√µes e ofertas da ArturiaSuplements.`]}),(0,c.jsx)(`span`,{className:`text-neutral-500 text-xs`,children:`CPF`}),(0,c.jsx)(`br`,{}),(0,c.jsx)(`input`,{className:`w-50 h-5 rounded border  ${F?`border-[#FF0000] text-neutral-800`:`border-neutral-200`}`,placeholder:`000.000.000-00`,required:!0,type:`text`,inputMode:`numeric`,value:y,onChange:e=>{let t=a(String(e.target.value||``).replace(/\D/g,``).slice(0,11));b(t);let n=``;t.length===14?o(t)||(n=`CPF inv√°lido`):n=`Preencha corretamente`,ne(n)}}),F&&(0,c.jsx)(`div`,{className:`text-xs`,style:{color:`#FF0000`},children:F}),(0,c.jsx)(`input`,{className:`w-50 h-5 rounded border border-neutral-300`,placeholder:`Nome completo *`,required:!0,type:`name`,value:_,onChange:e=>v(e.target.value)}),(0,c.jsx)(`input`,{className:`w-50 h-5 rounded border border-neutral-300`,placeholder:`Data de nascimento`}),(0,c.jsx)(`div`,{className:``,children:(0,c.jsx)(`input`,{className:`w-50 h-5 rounded border border-neutral-300 `,placeholder:`Telefone celular `})}),(0,c.jsxs)(`label`,{className:`flex items-center gap-2 text-sm`,children:[(0,c.jsx)(`input`,{type:`checkbox`,className:`h-4 w-4`}),` Quero receber promo√ß√µes via WhatsApp.`]}),(0,c.jsx)(`div`,{className:`text-sm`,children:`G√™nero`}),(0,c.jsxs)(`div`,{className:`flex items-center gap-4 text-sm`,children:[(0,c.jsxs)(`label`,{className:`inline-flex items-center gap-2`,children:[(0,c.jsx)(`input`,{type:`radio`,name:`gender`}),` Masculino`]}),(0,c.jsxs)(`label`,{className:`inline-flex items-center gap-2`,children:[(0,c.jsx)(`input`,{type:`radio`,name:`gender`}),` Feminino`]}),(0,c.jsxs)(`label`,{className:`inline-flex items-center gap-2`,children:[(0,c.jsx)(`input`,{type:`radio`,name:`gender`}),` Outro`]})]}),(0,c.jsx)(`div`,{className:`h-1 w-full bg-neutral-200 rounded`}),(0,c.jsx)(`button`,{className:`w-full rounded-md border border-[#00d000] bg-[#00d000] hover:bg-[#00b815] text-white py-2 px-4 font-semibold`,onClick:()=>i(2),children:`Ir para entrega`}),(0,c.jsx)(`div`,{className:`mt-2 text-green-700 text-sm`,children:`Compra 100% segura`}),(0,c.jsx)(`div`,{className:`text-[11px] text-neutral-600`,children:`Seus dados pessoais est√£o protegidos, todas as informa√ß√µes s√£o criptografadas para sua seguran√ßa.`})]})]})]}),(0,c.jsxs)(`section`,{className:`rounded-md border border-neutral-200 ${n<2?`opacity-60 pointer-events-none`:``}`,children:[(0,c.jsx)(`div`,{className:`bg-neutral-100 px-4 py-2 text-neutral-700 font-semibold`,children:`2. Endere√ßo`}),(0,c.jsxs)(`div`,{className:`p-4`,children:[(0,c.jsx)(`div`,{className:`text-green-700 font-medium mb-2`,children:`Endere√ßo de entrega`}),(0,c.jsxs)(`div`,{className:`space-y-3`,children:[(0,c.jsx)(`input`,{className:`w-full rounded border border-neutral-300 p-2`,placeholder:`CEP *`}),(0,c.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,c.jsx)(`input`,{className:`rounded border border-neutral-300 p-2`,placeholder:`Endere√ßo *`}),(0,c.jsx)(`input`,{className:`rounded border border-neutral-300 p-2`,placeholder:`N√∫mero *`})]}),(0,c.jsx)(`input`,{className:`w-full rounded border border-neutral-300 p-2`,placeholder:`Complemento`}),(0,c.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,c.jsx)(`input`,{className:`rounded border border-neutral-300 p-2`,placeholder:`Bairro *`}),(0,c.jsx)(`input`,{className:`rounded border border-neutral-300 p-2`,placeholder:`Cidade *`})]}),(0,c.jsx)(`input`,{className:`w-full rounded border border-neutral-300 p-2`,placeholder:`Estado (UF) *`}),(0,c.jsx)(`button`,{className:`w-full border border-[#00d000] rounded-md bg-[#00d000] hover:bg-[#00b840] text-white py-2 px-4 font-semibold`,onClick:()=>i(3),children:`Ir para pagamento`}),(0,c.jsx)(`div`,{className:`mt-2 text-green-700 text-sm`,children:`Compra 100% segura`}),(0,c.jsx)(`div`,{className:`text-[11px] text-neutral-600`,children:`100% do seu dinheiro de volta, em caso de reembolso!`})]})]})]}),(0,c.jsxs)(`section`,{className:`rounded-md border border-neutral-200 ${n<3?`opacity-60 pointer-events-none`:``}`,children:[(0,c.jsx)(`div`,{className:`bg-neutral-100 px-4 py-2 text-neutral-700 font-semibold`,children:`3. Pagamento`}),(0,c.jsx)(`div`,{className:`p-4 text-center text-neutral-700`,children:`Escolha a forma de pagamento`}),(0,c.jsxs)(`div`,{className:`px-4 pb-4 space-y-2`,children:[H.map(e=>(0,c.jsx)(`button`,{className:`w-full rounded border border-neutral-300 bg-neutral-100 p-3 text-left transition ${l===e.id?`ring-2 ring-green-600 bg-neutral-50`:`hover:bg-neutral-200`}`,onClick:()=>u(e.id),children:e.label},e.id)),w&&(0,c.jsx)(`div`,{className:`text-red-700`,children:w}),l===`pix`&&(0,c.jsxs)(`div`,{className:`mt-2 text-sm text-neutral-700`,children:[U&&(0,c.jsx)(`div`,{className:`text-neutral-700`,children:`Iniciando pagamento PIX...`}),G&&(0,c.jsxs)(`div`,{className:`text-red-700`,children:[`Erro: `,G]}),q&&(0,c.jsxs)(`div`,{className:`space-y-1`,children:[(0,c.jsx)(`div`,{className:`text-green-700 font-medium`,children:`PIX iniciado`}),M>0&&(0,c.jsxs)(`div`,{className:`text-xs text-neutral-600`,children:[`Expira em `,Math.floor(M/60),`:`,String(M%60).padStart(2,`0`)]}),O&&(0,c.jsxs)(`div`,{className:`rounded-md border border-neutral-300 bg-white p-2 hidden sm:block text-center`,children:[(0,c.jsx)(`div`,{className:`text-xs text-neutral-600`,children:`QR Code`}),(0,c.jsx)(`img`,{src:O,alt:`QR Code PIX`,className:`h-40 w-40 object-contain mx-auto`})]}),(0,c.jsx)(`div`,{className:`text-xs text-neutral-600`,children:` Copia e cola a chave pix abaixo`}),E&&(0,c.jsx)(`div`,{className:`rounded-md border border-neutral-300 bg-white p-2`,children:(0,c.jsx)(`div`,{className:`font-mono text-xs break-all select-all`,children:E})}),(0,c.jsx)(`div`,{className:`mt-1`,children:(0,c.jsxs)(`button`,{className:`inline-flex items-center  gap-2 rounded-md border border-neutral-300 bg-green-600 hover:bg-green-700 text-white px-10 py-2 focus:outline-none focus:ring-2 focus:ring-green-600`,onClick:oe,children:[(0,c.jsx)(`span`,{"aria-hidden":`true`,children:`üìã`}),`Copiar chave`]})})]})]}),re&&(0,c.jsx)(`div`,{className:`rounded-md border border-green-300 bg-green-50 p-3 text-green-700`,children:`E-mail de confirma√ß√£o enviado`}),Y&&(0,c.jsxs)(`div`,{className:`rounded-md border border-red-300 bg-red-50 p-3 text-red-700`,children:[`Falha ao enviar e-mail: `,Y]}),(0,c.jsx)(`div`,{className:`pt-2`,children:(0,c.jsx)(`button`,{className:`w-full rounded-md bg-[#2e7d32] hover:bg-[#276628] text-white py-2 px-4 font-semibold`,onClick:ie,disabled:!l||!Q(h)||!String(_||``).trim()||!$(y),children:`FECHAR PEDIDO`})})]})]})]}),(0,c.jsx)(`div`,{children:(0,c.jsxs)(`section`,{className:`rounded-md border border-neutral-200 bg-white`,children:[(0,c.jsx)(`div`,{className:`px-4 py-2 bg-neutral-100 text-neutral-800 font-medium`,children:`Resumo do pedido`}),(0,c.jsx)(`ul`,{className:` list-none divide-y divide-neutral-200 `,style:{padding:`0px 15px 0px 12px`},children:I.map((e,t)=>{let n=Array.isArray(e.images)&&e.images[0]||e.image;return(0,c.jsx)(`li`,{className:` list-none m-0 p-0`,style:{padding:`10px 15px 10px 0px`},children:(0,c.jsxs)(`div`,{className:`flex items-center gap-3`,children:[n?(0,c.jsx)(`img`,{src:n,alt:e.name??e.title??`Produto`,className:`h-12 w-12 object-contain`}):(0,c.jsx)(`div`,{className:`h-12 w-12 rounded bg-neutral-100`}),(0,c.jsxs)(`div`,{className:`flex-1`,children:[(0,c.jsx)(`div`,{className:`font-medium text-sm`,children:e.name??e.title??`Produto`}),(0,c.jsxs)(`div`,{className:`text-[11px] text-neutral-600`,children:[`Quantidade: `,e.qty]}),(0,c.jsxs)(`div`,{className:`text-[11px] text-neutral-600`,children:[`R$ `,(e.price??0).toFixed(2)]})]})]})},t)})}),(0,c.jsxs)(`div`,{className:`p-4 space-y-2`,children:[(0,c.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,c.jsx)(`span`,{className:`text-neutral-700`,children:`Subtotal:`}),(0,c.jsxs)(`span`,{className:`text-neutral-700`,children:[`R$ `,L.toFixed(2)]})]}),(0,c.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,c.jsx)(`span`,{className:`text-neutral-700`,children:`Frete:`}),(0,c.jsxs)(`span`,{className:`text-neutral-700 line-through`,children:[`R$ `,z.toFixed(2)]})]}),(0,c.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,c.jsx)(`span`,{className:`text-neutral-700`,children:`Pre√ßo sem desconto:`}),(0,c.jsxs)(`span`,{className:`text-neutral-700`,children:[`R$ `,R.toFixed(2)]})]}),(0,c.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,c.jsx)(`span`,{className:`text-neutral-900 font-semibold`,children:`Total com desconto aplicado:`}),(0,c.jsxs)(`span`,{className:`text-xl font-semibold text-green-700`,children:[`R$ `,B.toFixed(2)]})]}),(0,c.jsx)(`div`,{className:`text-green-700 text-sm`,children:`Garanta 10% de desconto no PIX.`}),(0,c.jsxs)(`div`,{className:`text-green-700 font-semibold`,children:[`R$ `,(L*.9).toFixed(2)]}),(0,c.jsxs)(`div`,{className:`text-neutral-700 text-sm`,children:[`Ganhe at√© `,V,` pontos nesta compra.`]}),(0,c.jsx)(`div`,{})]})]})})]})]})}export{l as default};